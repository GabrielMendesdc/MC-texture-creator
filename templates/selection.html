<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selecione suas Texturas - Minecraft Texture Mixer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* Estilos para as cores do Minecraft */
        /* Estas cores são as mesmas definidas em format_minecraft_text no app.py */
        .mc-color-0 { color: #000000; } /* Black */
        .mc-color-1 { color: #0000AA; } /* Dark Blue */
        .mc-color-2 { color: #00AA00; } /* Dark Green */
        .mc-color-3 { color: #00AAAA; } /* Dark Aqua */
        .mc-color-4 { color: #AA0000; } /* Dark Red */
        .mc-color-5 { color: #AA00AA; } /* Dark Purple */
        .mc-color-6 { color: #FFAA00; } /* Gold */
        .mc-color-7 { color: #AAAAAA; } /* Gray */
        .mc-color-8 { color: #555555; } /* Dark Gray */
        .mc-color-9 { color: #5555FF; } /* Blue */
        .mc-color-a { color: #55FF55; } /* Green */
        .mc-color-b { color: #55FFFF; } /* Aqua */
        .mc-color-c { color: #FF5555; } /* Red */
        .mc-color-d { color: #FF55FF; } /* Light Purple */
        .mc-color-e { color: #FFFF55; } /* Yellow */
        .mc-color-f { color: #FFFFFF; } /* White */

        /* Estilos para formatação especial */
        .mc-bold { font-weight: bold; }
        .mc-strikethrough { text-decoration: line-through; }
        .mc-underline { text-decoration: underline; }
        .mc-italic { font-style: italic; }
        .mc-obfuscated { 
            /* Obfuscated é difícil com CSS puro. */
            /* Você pode tentar uma fonte que simule ou usar um fallback como: */
            text-transform: uppercase;
            letter-spacing: 0.1em;
            animation: obfuscate 0.5s infinite alternate; /* Exemplo de animação simples */
        }
        /* Exemplo de keyframes para animação obfuscada */
        @keyframes obfuscate {
            from { opacity: 1; }
            to { opacity: 0.5; letter-spacing: 0.2em; }
        }

        .mc-reset {
            color: inherit; /* Volta para a cor do elemento pai */
            font-weight: normal;
            text-decoration: none;
            font-style: normal;
            text-transform: none;
            letter-spacing: normal;
            animation: none; /* Desativa a animação de obfuscate */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Selecione suas Texturas</h1>

        <h2>Packs Enviados:</h2>
        {% if uploaded_packs_data %}
            <ul class="pack-list">
                {% for pack in uploaded_packs_data %}
                    {# Exibe o nome já formatado, sem o ID #}
                    <li>{{ pack.formatted_name | safe }}</li> 
                {% endfor %}
            </ul>
        {% else %}
            <p class="warning">Nenhum pack foi enviado ou pôde ser analisado. Por favor, <a href="{{ url_for('index') }}">volte e faça o upload</a>.</p>
        {% endif %}

        <div class="selection-area">
            <form action="{{ url_for('generate_pack') }}" method="post">
                <div class="profile-selection">
                    <h3>Escolha um Perfil:</h3>
                    {% for profile_id, profile_data in profiles.items() %}
                        <label>
                            <input type="radio" name="profile_selection" value="{{ profile_id }}"
                                   {% if profile_id == 'bedwars' %} checked {% endif %} {# Perfil padrão Bedwars #}
                                   onchange="updateTextureOptions(this.value)">
                            {{ profile_data.name }}
                        </label>
                    {% endfor %}
                </div>

                <h2>Opções de Textura por Item</h2>
                <div id="texture_options_container">
                    {# Este bloco será preenchido e atualizado via JavaScript #}
                </div>

                <button type="submit">Gerar Pack Personalizado</button>
            </form>
        </div>
    </div>

    <script>
        const allTextures = {{ textures_dict | tojson }};
        // Mapeamento das categorias com base nos nomes do TEXTURE_MAPPING
        const categorias = {
            blocos: [
                "Lã", "Madeira (Tábuas)", "Pedra"
            ],
            minerios: [
                "Minério de Diamante", "Minério de Esmeralda", "Esmeralda (Item)"
                // Você pode adicionar manualmente outros ores e ingots aqui
            ],
            ferramentas: [
                "Espada de Diamante", "Espada de Ferro", "Espada de Ouro", "Espada de Madeira", "Espada de Pedra",
                "Picareta de Diamante", "Picareta de Ferro", "Picareta de Ouro", "Picareta de Madeira", "Picareta de Pedra",
                "Machado de Diamante", "Machado de Ferro", "Machado de Ouro", "Machado de Madeira", "Machado de Pedra",
                "Pá de Diamante", "Pá de Ferro", "Pá de Ouro", "Pá de Madeira", "Pá de Pedra",
                "Enxada de Diamante", "Enxada de Ferro", "Enxada de Ouro", "Enxada de Madeira", "Enxada de Pedra",
                "Arco", "Flecha"
            ],
            armaduras: [
                // Armaduras de Diamante
                "Capacete de Diamante", "Peitoral de Diamante", "Calças de Diamante", "Botas de Diamante",
                // Armaduras de Ferro
                "Capacete de Ferro", "Peitoral de Ferro", "Calças de Ferro", "Botas de Ferro",
                // Armaduras de Ouro
                "Capacete de Ouro", "Peitoral de Ouro", "Calças de Ouro", "Botas de Ouro",
                // Armaduras de Couro
                "Capacete de Couro", "Peitoral de Couro", "Calças de Couro", "Botas de Couro"
            ]
        };

        function renderizarGrupo(titulo, listaItens) {
            let grupoHtml = `<div class="item-group"><h3>${titulo}</h3><div class="group-grid">`;

            listaItens.forEach(itemName => {
                if (allTextures[itemName]) {
                    const src = allTextures[itemName].static_url_path || "";
                    grupoHtml += `
                        <div class="selection-group">
                            <label>${itemName}</label>
                            <img class="texture-preview" src="${src}" alt="${itemName}">
                        </div>
                    `;
                }
            });
            grupoHtml += "</div></div>";
            return grupoHtml;
        }

        function montarPreviewsPorCategoria() {
            const container = document.getElementById("texture_options_container");
            let html = "";
            html += renderizarGrupo("Blocos", categorias.blocos);
            html += renderizarGrupo("Minérios", categorias.minerios);
            html += renderizarGrupo("Ferramentas", categorias.ferramentas);
            html += renderizarGrupo("Armaduras", categorias.armaduras);
            container.innerHTML = html;
        }

        document.addEventListener('DOMContentLoaded', () => {
            montarPreviewsPorCategoria();
        });
    </script>
</body>
</html>
